# 古诗词接龙联机版

这是一个基于 Node.js 和 Socket.IO 构建的网页版多人实时联机古诗词接龙游戏。

## 游戏特色

- **实时联机**: 与朋友们在同一个房间里实时对战。
- **房间系统**: 创建或加入游戏房间，每个房间的游戏进程完全独立。
- **URL路由**: 每个房间都有专属链接 (e.g., `/room/ABCD`)，方便分享和重连。
- **断线重连**: 刷新页面或短暂断开网络后，可以自动返回之前的游戏。
- **民主投票**: 诗句的有效性由房间内除提交者外的所有玩家共同投票决定，超时或掉线默认计为赞同。
- **非阻塞验证队列**: 玩家可以随时提交答案进入等待队列，系统会自动、依次处理，不会因为一次投票而阻塞所有人的输入。
- **灵活撤回**: 玩家可以随时撤回自己提交的、尚未被确认的答案，即使该答案正在被投票。
- **数据持久化**: 房间状态和已验证的诗句会被保存在服务器本地，重启服务器后游戏可以继续。

## 技术栈

- **前端**:
  - HTML5
  - CSS3
  - JavaScript (ES6+)
- **后端**:
  - Node.js
  - Express.js (用于提供静态文件和路由)
  - Socket.IO (用于实现实时双向通信)
- **数据存储**:
  - 本地 JSON 文件 (用于持久化房间和诗句缓存)

## 项目结构

```
.
├── data/                  # 存储持久化数据（由服务器生成）
│   ├── rooms.json         # 存储所有房间的状态
│   └── valid_sentences.json # 存储所有已被确认为有效的诗句
├── public/                # 存放所有客户端静态文件
│   ├── index.html         # 主页面HTML
│   ├── style.css          # 页面样式
│   └── client.js          # 客户端逻辑
├── server.js              # 后端主程序
├── package.json
└── README.md
```

## 安装与运行

### 1. 环境准备

确保你的电脑上已经安装了 [Node.js](https://nodejs.org/) (推荐 LTS 版本)。

### 2. 安装依赖

在项目根目录下，打开终端并运行以下命令来安装项目所需的所有依赖库：

```bash
npm install
```
这将会根据 `package.json` 文件安装所有必需的依赖库，包括 `express`, `socket.io`, `body-parser` 等。

**对于已克隆本项目的协作者**：在拉取了包含 `package.json` 变更的更新后，请重新运行 `npm install` 以确保您的本地依赖是最新的。

### 3. 运行服务器

安装完依赖后，运行以下命令来启动游戏服务器：

```bash
node server.js
```

当你在终端看到 `服务器正在端口 3000 上运行` 的提示时，说明服务器已成功启动。

### 4. 开始游戏

打开你的网络浏览器 (推荐 Chrome 或 Firefox)，访问以下地址：

[http://localhost:3000](http://localhost:3000)

你将看到游戏大厅。你可以：
- **创建新房间**: 点击按钮，输入你的昵称，即可创建一个拥有随机ID的新房间。
- **加入房间**: 点击房间列表中的“加入”按钮，输入你的昵称，即可加入一个已存在的房间。
- **通过URL加入**: 将一个房间的链接 (例如 `http://localhost:3000/room/ABCD`) 分享给朋友，他们可以通过该链接直接尝试加入你的房间。

## 游戏规则概览

1.  **进入大厅**: 玩家首先进入游戏大厅，可以查看、创建或加入房间。
2.  **开始游戏**: 房间内至少需要2名玩家才能开始游戏。游戏开始后，系统会给出一个起始字。
3.  **回答**: 玩家需要根据当前的起始字，在输入框中输入一句不含标点符号的古诗词。
4.  **提交与排队**:
    -   每个玩家在队列中最多只能有一个待验证的答案。
    -   所有提交的答案会进入一个验证队列，系统会按顺序处理。
5.  **验证与投票**:
    -   系统会先检查答案是否在“已验证诗句”的缓存中。
    -   如果不在，该诗句将交由房间内除提交者外的所有其他玩家进行投票。
    -   投票限时15秒，超时或掉线默认计为**赞同**。
    -   当赞同票数**严格多于**反对票数时，诗句被确认为有效。
6.  **得分与新回合**:
    -   回答正确的玩家获得一分。
    -   该玩家将获得从他回答的诗句中选择一个新的起始字的权利。
    -   选定新字后，新一轮开始。
7.  **撤回**: 玩家可以随时撤回自己提交的答案，即使它正在被投票。如果撤回的是正在投票的答案，该次投票将立即中断。

